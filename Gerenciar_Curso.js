const db=firebase.firestore(),messaging=firebase.messaging(),uid=localStorage.getItem("Uid");var nomeSession;try{class a{constructor(a,b,c){this.id=a,this.cursoAntigo=b,this.curso=c}editar(){document.querySelector("div[class='container-loader']").style.display="none",db.collection("cursos").doc(this.id).update({curso:this.curso}).then(()=>{const a=new Date,b=(a.getDate()+"").padStart(2,"0"),c=(a.getMonth()+1+"").padStart(2,"0"),d=a.getFullYear()+"";var e=a.getHours()+"";0==e&&(e=a.getHours()+""+"0");var f=a.getMinutes()+"";f=10>f?(a.getMinutes()+"").padStart(2,"0"):a.getMinutes()+"";const g=`${b}/${c}/${d} as ${e}:${f}`;db.collection("historico").add({usuarioUID:uid,alteracao:`O usuario ${nomeSession} alterou o curso "${this.cursoAntigo}" para "${this.curso}" no dia ${g}`,data_hora:g}).then(()=>{alert("Curso alterado com sucesso"),location.reload()}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})}}db.collection("cursos").get().then(a=>{const b=document.querySelector("select[name=\"cursos\"]");if(0==a.docs.length){b.innerHTML+="<option>Nenhum curso cadastrado :/</option>"}else{const c=a.docs.reduce((a,b)=>(a+=`<option>${b.data().curso}</option>`,a),"");b.innerHTML+=c}}).catch(a=>{alert(a.message)}),document.querySelector("button").addEventListener("click",function(){const b=new FormData(document.querySelector("form")),c=b.get("cursos"),d=b.get("todos");if("editar"===d){const b=document.querySelector("form[class='principalForm']"),d=document.querySelector("form[class='editarForm']");b.style.display="none",d.style.display="block",db.collection("cursos").where("curso","==",c).get().then(b=>{b.forEach(b=>{document.querySelector("input[name='curso']").value=b.data().curso,document.querySelector("button[class='editar']").addEventListener("click",function(){const c=new FormData(d),e=c.get("curso").trim();0==e.length?alert("Preencha todos os campos"):db.collection("cursos").where("curso","==",e).get().then(c=>{if(0<c.docs.length)document.querySelector("div[class='container-loader']").style.display="none",alert("Curso existente");else{document.querySelector("div[class='container-loader']").style.display="block";var d=new a(b.id,b.data().curso,e);d.editar()}}).catch(a=>{alert(a.message)})})})}).catch(a=>{alert(a.message)})}else"excluir"===d?db.collection("cursos").where("curso","==",c).get().then(a=>{a.forEach(a=>{confirm("Deseja excluir este curso?")&&db.collection("cursos").doc(a.id).delete().then(()=>{const b=new Date,c=(b.getDate()+"").padStart(2,"0"),d=(b.getMonth()+1+"").padStart(2,"0"),e=b.getFullYear()+"";var f=b.getHours()+"";0==f&&(f=b.getHours()+"0");var g=b.getMinutes()+"";g=10>g?(b.getMinutes()+"").padStart(2,"0"):b.getMinutes()+"";const h=`${c}/${d}/${e} as ${f}:${g}`;db.collection("historico").add({usuarioUID:uid,alteracao:`O usuario: ${nomeSession} deletou o curso "${a.data().curso}" no dia ${h}`,data_hora:h}).then(()=>{alert("Curso deletado com sucesso"),location.reload()}).catch(a=>{alert(a.message)})}).catch(a=>{alert(a.message)})})}).catch(a=>{alert(a.message)}):alert("Voc\xEA deseja editar ou excluir este perfil?")})}catch(a){alert("Erro "+a)}